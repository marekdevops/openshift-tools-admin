# OpenShift Tools - Dodatek do tmux (nie nadpisuje istniejących ustawień)
# Dołącz do ~/.tmux.conf:
#   source-file ~/.local/share/openshift-tools/config/tmux-ocp-addon.conf

# ============================================
# STATUSLINE - TYLKO PRAWA STRONA Z KLASTREM
# ============================================

# Aktualizuj co 5 sekund (jeśli nie masz ustawionego)
set -g status-interval 5

# Prawa strona - dołącz klaster OCP do istniejącego statusline
# Używa skryptu tmux-ocp-status dla kolorów
set -ga status-right '#[fg=colour244] │ #(~/.local/share/openshift-tools/bin/tmux-ocp-status)'

# ============================================
# SKRÓTY DLA OPENSHIFT (Prefix + ...)
# ============================================

# Prefix + o - pokaż info o klastrze (popup)
bind o display-popup -E "\
    echo '=== OpenShift Context ===' && \
    echo '' && \
    echo \"Klaster: \$(basename \"\$KUBECONFIG\" 2>/dev/null || echo 'brak')\" && \
    echo \"User: \$(oc whoami 2>/dev/null || echo 'nie połączony')\" && \
    echo \"Project: \$(oc project -q 2>/dev/null || echo 'brak')\" && \
    echo \"API: \$(oc whoami --show-server 2>/dev/null || echo '---')\" && \
    echo '' && \
    read -p 'Naciśnij Enter...' _"

# Prefix + O - przełącz klaster (popup z listą)
bind O display-popup -E "\
    echo 'Wybierz klaster:' && \
    echo '' && \
    select cluster in \$(ls ~/.kube/clusters 2>/dev/null) 'Anuluj'; do \
        if [ \"\$cluster\" = 'Anuluj' ]; then break; fi; \
        if [ -n \"\$cluster\" ]; then \
            tmux send-keys -t \${TMUX_PANE} \"export KUBECONFIG=~/.kube/clusters/\$cluster\" Enter; \
            break; \
        fi; \
    done"

# Prefix + k - oc get pods
bind k send-keys "oc get pods" Enter

# Prefix + K - watch na pody
bind K send-keys "watch -n2 'oc get pods'" Enter

# Prefix + g - oc get (czeka na dokończenie)
bind g send-keys "oc get "

# Prefix + G - oc describe (czeka na dokończenie)
bind G send-keys "oc describe "
