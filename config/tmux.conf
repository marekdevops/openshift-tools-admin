# OpenShift Tools - Konfiguracja tmux
# Skopiuj do: ~/.tmux.conf
# Lub dołącz: echo "source-file ~/.local/share/openshift-tools/config/tmux.conf" >> ~/.tmux.conf

# ============================================
# PODSTAWOWE USTAWIENIA
# ============================================

# Prefix: Ctrl+a (opcjonalnie, domyślnie Ctrl+b)
# set -g prefix C-a
# unbind C-b
# bind C-a send-prefix

# Indeksowanie od 1 (łatwiej na klawiaturze)
set -g base-index 1
setw -g pane-base-index 1

# Automatyczne przenumerowanie okien
set -g renumber-windows on

# Historia
set -g history-limit 50000

# Szybkie przeładowanie konfiguracji
bind r source-file ~/.tmux.conf \; display "Konfiguracja przeładowana!"

# Podział paneli - intuicyjne klawisze
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Nawigacja między panelami - Alt+strzałki
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Nawigacja między oknami - Shift+strzałki
bind -n S-Left previous-window
bind -n S-Right next-window

# Mysz
set -g mouse on

# ============================================
# WYGLĄD - KOLORY
# ============================================

# 256 kolorów
set -g default-terminal "screen-256color"

# Kolory paneli
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour39

# ============================================
# STATUSLINE Z KLASTREM OPENSHIFT
# ============================================

# Aktualizuj co 5 sekund
set -g status-interval 5

# Pozycja
set -g status-position bottom

# Długość
set -g status-left-length 50
set -g status-right-length 100

# Kolory statusline
set -g status-style bg=colour234,fg=colour255

# Lewa strona - sesja i numer okna
set -g status-left "#[fg=colour234,bg=colour39,bold] #S #[fg=colour39,bg=colour234] "

# Środek - lista okien
setw -g window-status-format "#[fg=colour244] #I:#W "
setw -g window-status-current-format "#[fg=colour234,bg=colour208,bold] #I:#W "

# Prawa strona - KLASTER OPENSHIFT + czas
# Pobiera OCP_CLUSTER lub wyciąga z KUBECONFIG
set -g status-right '#[fg=colour244]│ #[fg=colour39]☸ #(if [ -n "$OCP_CLUSTER" ]; then echo "$OCP_CLUSTER"; elif [ -n "$KUBECONFIG" ]; then basename "$KUBECONFIG"; else echo "---"; fi) #[fg=colour244]│ #[fg=colour255]%H:%M '

# ============================================
# WARIANT Z KOLOROWYM KLASTREM (PROD=CZERWONY)
# ============================================

# Skrypt pomocniczy do kolorowania klastra
# Odkomentuj poniższe linie jeśli chcesz kolorowy statusline

# set -g status-right '#[fg=colour244]│ #(~/.local/share/openshift-tools/bin/tmux-ocp-status) #[fg=colour244]│ #[fg=colour255]%H:%M '

# ============================================
# SKRÓTY DLA OPENSHIFT
# ============================================

# Prefix + o - pokaż info o klastrze
bind o display-popup -E "echo '=== OpenShift Context ===' && echo '' && echo \"Klaster: \$(basename \"\$KUBECONFIG\" 2>/dev/null || echo 'brak')\" && echo \"User: \$(oc whoami 2>/dev/null || echo 'nie połączony')\" && echo \"Project: \$(oc project -q 2>/dev/null || echo 'brak')\" && echo '' && read -p 'Naciśnij Enter...' _"

# Prefix + O - przełącz klaster (wymaga fzf)
bind O display-popup -E "ls ~/.kube/clusters 2>/dev/null | fzf --header='Wybierz klaster:' | xargs -I{} tmux send-keys 'export KUBECONFIG=~/.kube/clusters/{}' Enter"

# Prefix + k - lista podów
bind k send-keys "oc get pods" Enter

# Prefix + K - watch na pody
bind K send-keys "watch -n2 'oc get pods'" Enter

# ============================================
# UKŁAD DLA OPENSHIFT (opcjonalnie)
# ============================================

# Prefix + L - layout 2x2 dla monitoringu
bind L \
    split-window -h -c "#{pane_current_path}" \; \
    split-window -v -c "#{pane_current_path}" \; \
    select-pane -t 1 \; \
    split-window -v -c "#{pane_current_path}" \; \
    select-pane -t 1 \; \
    send-keys "oc get pods -w" Enter \; \
    select-pane -t 2 \; \
    send-keys "oc get events -w" Enter \; \
    select-pane -t 3 \; \
    send-keys "oc logs -f \$(oc get pods -o name | head -1) 2>/dev/null || echo 'Brak podów'" Enter \; \
    select-pane -t 4
